---
import { SITE, LINKS } from "@consts"
import { cn } from "@lib/utils"
const { pathname } = Astro.url
const subpath = pathname.match(/[^/]+/g)
import Container from "@components/Container.astro"
---

<header id="header" class="px-5 mb-4 z-10">
  <div class="max-w-screen-md mx-auto w-full">
    <div class="flex items-center justify-center">
      <!-- Single Centered Rounded Navbar with Everything Inside -->
      <div class="flex items-center justify-between px-4 py-3 rounded-2xl backdrop-blur-md bg-black/10 dark:bg-white/10 border border-black/10 dark:border-white/20 shadow-lg w-full">
        <!-- Left Side: Logo -->
        <a href="/" class="flex items-center">
          <img src="/brand.png" alt={SITE.TITLE} class="h-7 w-auto" />
        </a>
        
        <!-- Center: Navigation Links -->
        <div class="hidden md:flex items-center gap-1">
          {
            LINKS.map((LINK) => (
              <a href={LINK.HREF} class={cn("h-8 rounded-full px-4 text-sm text-current", "flex items-center justify-center", "transition-colors duration-300 ease-in-out", pathname === LINK.HREF || "/" + subpath?.[0] === LINK.HREF ? "bg-black dark:bg-white text-white dark:text-black" : "hover:bg-black/5 dark:hover:bg-white/20 hover:text-black dark:hover:text-white")}>
                {LINK.TEXT}
              </a>
            ))
          }
        </div>
        
        <!-- Right Side: Theme Toggle / Mobile Menu -->
        <div class="flex items-center gap-2">
          <!-- Desktop: Theme Toggle -->
          <button id="header-theme-button" aria-label={`Toggle light and dark theme`} class="hidden md:flex size-8 rounded-full items-center justify-center hover:bg-black/10 dark:hover:bg-white/20 transition-colors duration-300 ease-in-out stroke-current hover:stroke-black hover:dark:stroke-white">
            <svg class="size-5 block dark:hidden">
              <use href="/ui.svg#sun"></use>
            </svg>
            <svg class="size-5 hidden dark:block">
              <use href="/ui.svg#moon"></use>
            </svg>
          </button>
          
          <!-- Mobile: Menu Button -->
          <button id="header-drawer-button" aria-label={`Toggle drawer open and closed`} class="flex md:hidden size-8 rounded-full items-center justify-center hover:bg-black/10 dark:hover:bg-white/20 stroke-current hover:stroke-black hover:dark:stroke-white">
            <svg id="drawer-open" class="size-full">
              <use href="/ui.svg#menu"></use>
            </svg>
            <svg id="drawer-close" class="size-full">
              <use href="/ui.svg#x"></use>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  #header-drawer-button > #drawer-open {
    @apply block;
  }

  #header-drawer-button > #drawer-close {
    @apply hidden;
  }

  #header-drawer-button.open > #drawer-open {
    @apply hidden;
  }

  #header-drawer-button.open > #drawer-close {
    @apply block;
  }
</style>

<script is:inline>
  function toggleDrawer() {
    const drawer = document.getElementById("drawer")
    const drawerButton = document.getElementById("header-drawer-button")
    drawer?.classList.toggle("open")
    drawerButton?.classList.toggle("open")
  }

  function initializeDrawerButton() {
    const drawerButton = document.getElementById("header-drawer-button")
    drawerButton?.addEventListener("click", toggleDrawer)
  }

  document.addEventListener("astro:after-swap", initializeDrawerButton)
  initializeDrawerButton()
</script>
